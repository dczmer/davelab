# 02 - Configuring Your Prompt

## Objective

By the end of this section, you will have implemented a custom prompt and decide what information you want it to include. We will see how to add support for displaying info about the current `git` branch.

At the end, we'll talk about programs you can use to configure your prompt for you, if you want to go that way. But you should still read along and follow the simple exercises to help build a bit of context about what you are actually doing.

## Overview

> **NOTE:** The icon characters used in some of the example format-strings require a specific font and configure your terminal emulator to use it.
> See [Nerd Font](https://www.nerdfonts.com/#home) for details.
> That means you will probably not see the correct icons when they are displayed in your web browser either.
>
> I like the monospace [`hack`](https://www.programmingfonts.org/#hack) font, personally.
>
> If you do not want to install a new font, you can either omit the lines with broken fonts, or you can replace them with ASCII characters or unicode glyphs supported by your current font.
>
> If you are on Mac, you should be able to install these fonts via `homebrew`.

The default `zsh` prompt is very basic, usually just the system's `hostname` followed by a '%'.

But you can configure the prompt to show whatever information you want, like the current working directory, the date and time, the name of the current git branch, and whether you have changes that have not been committed, etc.

The default `zsh` prompt:

![image](./images/PS1-default.png "Default prompt")

The simple, hand-made `zsh` prompt we create in this chapter:

![image](./images/PS1-simple.png)

An example of a prompt generated by another program (`p10k`):

![image](./images/PS1-p10k.png)

Things you might want in your prompt:

- The current working directory
- Git/VCS info (branch, action, staged/unstaged changes, etc.)
- The current date or time
- The status code of the previous command (`$?`)
- The number of background jobs (running programs sent to the background with `ctrl-z`)

We will use `print -P` to test out some different prompt strings, configure a `git` info section, and then `source` the included `prompt-example.zsh` and test out the difference.

You can copy the contents of the example file and add it to your own `.zshrc` file, but these options are more subjective to personal preference, so you might want to customize things a little further.

### Exploring the Example Configuration

Open this document in a window on one side of your screen and open your terminal emulator on the other half.

Start a fresh `zsh` session:

```zsh
zsh -df
```

![image](./images/PS1-default.png "Default prompt")

Take note of the default prompt, then import the example file and observe the difference:

```zsh
source ./prompt-example.zsh
```

![image](./images/PS1-simple.png)

## The `PS1` Variable

The shell prompt is actually defined in an environment variable that you can set in your `~/.zshrc` file.

To see your current prompt-string:

```zsh
echo $PS1
 %m%# 
```

The `%` characters start special sequences that will be translated to specific values when the prompt is displayed. For example, `%m` will be replaced with the hostname of the host system.

## The Basics

You can test a prompt-string with `print -P`

```zsh
print -P "%m%# "
 hostname% 
```

Here are the options used in the prompt from the example file:

- `%1d` - `%d` prints the current working directory. The `1` means only show the current directory name, and not all of it's ancestors that make the full path.
- `%?` - The status code from the previous command in this session.

### Try it Out

Start a `zsh` session, but don't import the example file just yet:

```zsh
zsh -df
```

Run the following commands:

```zsh
echo $HOSTNAME
print -P "%m%# "
```

Try adding `%d` to print the current working directory, and then try with `%1d` instead. Try other numbers instead of just `1`, maybe even try some negative numbers...

Try running `man zshmisc` from the prompt and then searching (with `/`) for `"EXPANSION OF PROMPT SEQUENCES"` to see every code that is available. Add something to your prompt-string that we haven't covered.

## Colors and Escape Sequences

The traditional way of defining styles and colors in the terminal is to use [ANSI escape codes](https://en.wikipedia.org/wiki/ANSI_escape_code).

So if you wanted to print "HELLO" in green, bold text, with underline, you'd write something like:

```bash
echo "\033[32;1;4mHELLO\033[0m"
```

This is pretty archaic, but not as bad as it looks:

- `\033[...m` means anything between the `[` and the `m` should be interpreted as an escape sequence of integer values separated by ';' characters.
- `32` means foreground color green.
- `1` means **bold**
- `4` means <ins>underline</ins>.
- Then `\033[0m`, at the end, means reset to the default style again.

But `zsh` gives us some easier options for working with colors and styles:

```bash
print -P '%B%U%F{green}Hello%f%u%b'
```

OK, that doesn't look much better, but let's go over it:

- `%B...%b` - anything between `%B` and `%b` will be **bold**.
- `%U...%u` - anything between `%U` and `%u` will be <ins>underlined</ins>.
- `%F{green}...%f` - anything between `}` and `%f` will have a green foreground color.

### Try it Out

Start a `zsh` session, but don't import the example file just yet:

```zsh
zsh -df
```

Try running `man zshmisc` from the prompt and then searching (with `/`) for `"EXPANSION OF PROMPT SEQUENCES"` to see every code that is available - and this time scroll down and look for the sub-section on 'Visual Effects.'

Try modifying this format string `%F{green}Hello%f` to have two sections of text, with opposite foreground and background colors. So maybe "HELLO" in green foreground and black background, and "WORLD" in black foreground and green background. Use `print -P` to test it out.

Notice that we're just printing a shell string, which means we can interpolate any environment variable into the shell, and we can run any command and put the standard out in the prompt as well.

Try including the current value of the `EDITOR` variable, which we set in the previous chapter. Use `$EDITOR` inside the prompt string, and make sure you are using double-quotes (`"`) around the prompt-string, because single-quotes won't allow interpolation.

Then try adding the output of a shell command using `$(command)` inside of your double-quoted prompt-string. Try printing the number of files from the current working directory using `$(ls . | wc -l)` in your prompt-string.

<details>

<summary>Answers</summary>

```zsh
print -P "%F{green}%K{black}Hello%k%f %F{black}%K{green}World%k%f"
print -P "[$EDITOR] --> Files=$(ls . | wc -l)"
```
</details>

## VCS (Git) Information

The example file includes a section that configures `zsh` to read information about the current git repository, and we use `zstyle` ton configure how it will be displayed in the prompt.

I won't explain the `zstyle` module, but you can run `man zshmodules` and search for `zstyle` for the official documentation, and there are a lot of good tutorials available on the internet.

I will go over some of the things that I think you may want to customize, using all of the things we've covered so far:

1. The normal `git` status format.

```zsh
zstyle ':vcs_info:git:*' formats '%F{green} %f(%b)%F{yellow}%u%c%f'
```

This format string will show:

- A green 'git' icon (you need a specific font to see it properly).
- The name of the current branch, in parentheses.
- In yellow, two characters that will indicate if you have pending staged or unstaged changes in your working tree. If you don't have any pending changes, these characters will not show up.

2. How to display the 'staged'/'unstaged' indicators:

If you want to use the `%u` and `%c` characters to indicate that you have pending changes, then you may want to customize the content they show. By default, they show a `U` and a `C`, but I've changed them to use icons (which you probably cannot see here, without the appropriate font):

```zsh
zstyle ':vcs_info:git:*' stagedstr " "
zstyle ':vcs_info:git:*' unstagedstr " "
```

You may want to use different icons, or entirely different format strings of some type. You can remove these two lines if you prefer the default `U` and `C` characters, or you can delete these lines and remove the `%c` and `%u` from the `git` status format string.

3. "Actions" format:

When you are performing an 'action', like resolving conflicts while trying to apply a merge or rebase, you can use this to show information about that operation in your prompt.

```zsh
zstyle ':vcs_info:git:*' actionformats '%F{green} %f(%F{yellow}%b%f|%F{red}%a%f)'
```

This is the same as the normal `git` prompt we defined, but it says the name of the 'action' ("merge", "rebase", etc.) inside the parentheses, where we have the branch name.

### Try it Out

Start a `zsh` session and source the example file:

```zsh
zsh -df
source ./prompt-example.zsh
```

Try creating a new branch with `git branch -b test-branch`, then re-`source` the example to force the `git` prompt to update.

Now try making a change to one of the files in this repository, which should make an 'unstaged' change. Re-`source` the example file to force the `git` prompt to update.

Now run `git add FILENAME` to stage that change (replace `FILENAME` with the name of the file that you modified). Re-`source` the example file again.

Now you can go back to the `master` branch with `git checkout master`.

If you want, delete that test branch with `git branch -D test-branch`.

## Prompt Configuration Applications

There are also programs and utilities that you can use to generate a more complicated, themed prompt. There are even programs that are designed to be run inside the prompt to dynamically change the prompt-string by using a language like Python.

Here are a couple that I know of:

- [powerlevel10k](https://github.com/romkatv/powerlevel10k)
    - This is old and will no longer be updated. It still works though.
    - This is a program that will generate a really complicated prompt-string with colors, and icons, and cool stuff.
- [starship](https://github.com/starship/starship)
    - This is the suggested replacement for `p10k`.
    - Advertised as being 'blazing-fast, and infinitely customizable'
- [powerline](https://powerline.readthedocs.io/en/master/index.html)
    - A python program that runs in your prompt string.
    - One of the original fancy-prompt tools.
    - Has support for shell prompts and `vim` status bar, to give consistent style and theme.
    - Downside: it's pretty slow and will often crash when your system python version changes.

If you want to go this way, I'd recommend `starship`.

I would stay away from `powerline` or anything else that runs "in your prompt string." When `powerline` crashes, it means you have no useful prompt, and sometimes you can't even interact with your shell!

But you already have a lean, fast, and personally customized prompt so you don't really need to use these.
