<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Configuring Your Prompt</title>
    <link rel="stylesheet" href="http://localhost:4000//jekyll-test/css/reset.css" />
    <link rel="stylesheet" href="http://localhost:4000//jekyll-test/css/dracula-rouge.css" />
    <link rel="stylesheet" href="http://localhost:4000//jekyll-test/css/site.css" />
    <link rel="shortuct icon" type="image/ico" href="http://localhost:4000//jekyll-test/img/favicon.ico" />
  </head>
  <body>
    <header>
      <section>
        <a href="/jekyll-test/"> davelab</a>
      </section>
      <section title="I feel like there needs to be something on this side...">
        <a href="https://github.com/dczmer/davelab.git">
           GitHub
        </a>
      </section>
    </header>
    <nav>
      <section>
        
        
          
          
          
        
          
          
          
            <section class="subnav">
              <span class="selected-module">
                Zsh configuration
              </span>
              <ul class="">
                
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/zsh_configuration/index"
                    >
                      ZSH Configuration Intro
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/zsh_configuration/01_zsh-config"
                    >
                      Basic ZSH Configuration
                    </a>
                  </li>
                
                  <li>
                    <a
                      class="selected-section"
                      href="http://localhost:4000/jekyll-test/zsh_configuration/02_prompt"
                    >
                      Configuring Your Prompt
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/zsh_configuration/03_completion"
                    >
                      The Completion System
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/zsh_configuration/04_complete-setup"
                    >
                      Completed Configuration
                    </a>
                  </li>
                
              </ul>
            </section>
          
        
          
          
          
            <section class="subnav">
              <span class="">
                Using the shell
              </span>
              <ul class="subnav-inactive">
                
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/index"
                    >
                      Shell Intro
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/01_help-hisory"
                    >
                      Finding Help
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/02_expansion-signals"
                    >
                      Expansion and Signals
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/03_streams-and-pipes"
                    >
                      (WIP) Streams and Pipes
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/04_commands"
                    >
                      Useful Commands
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/05_one-liners"
                    >
                      (WIP) Useful One-Liners
                    </a>
                  </li>
                
              </ul>
            </section>
          
        
          
          
          
            <section class="subnav">
              <span class="">
                Tmux
              </span>
              <ul class="subnav-inactive">
                
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/tmux/index"
                    >
                      Tmux Intro
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/tmux/01_basic-usage"
                    >
                      Tmux Basic Usage
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/tmux/02_configuration"
                    >
                      Tmux Configuration
                    </a>
                  </li>
                
              </ul>
            </section>
          
        
      </section>
    </nav>
    <main>
      <h1 id="configuring-your-prompt">Configuring Your Prompt</h1>

<ul id="markdown-toc">
  <li><a href="#configuring-your-prompt" id="markdown-toc-configuring-your-prompt">Configuring Your Prompt</a>    <ul>
      <li><a href="#overview" id="markdown-toc-overview">Overview</a>        <ul>
          <li><a href="#exploring-the-example-configuration" id="markdown-toc-exploring-the-example-configuration">Exploring the Example Configuration</a></li>
        </ul>
      </li>
      <li><a href="#the-ps1-variable" id="markdown-toc-the-ps1-variable">The PS1 Variable</a></li>
      <li><a href="#the-basics" id="markdown-toc-the-basics">The Basics</a>        <ul>
          <li><a href="#try-it-out" id="markdown-toc-try-it-out">Try it Out</a></li>
        </ul>
      </li>
      <li><a href="#colors-and-escape-sequences" id="markdown-toc-colors-and-escape-sequences">Colors and Escape Sequences</a>        <ul>
          <li><a href="#try-it-out-1" id="markdown-toc-try-it-out-1">Try it Out</a></li>
        </ul>
      </li>
      <li><a href="#vcs-git-information" id="markdown-toc-vcs-git-information">VCS (Git) Information</a>        <ul>
          <li><a href="#try-it-out-2" id="markdown-toc-try-it-out-2">Try it Out</a></li>
        </ul>
      </li>
      <li><a href="#the-rprompt-variable" id="markdown-toc-the-rprompt-variable">The RPROMPT Variable</a></li>
      <li><a href="#conditional-formats" id="markdown-toc-conditional-formats">Conditional Formats</a>        <ul>
          <li><a href="#try-it-out-3" id="markdown-toc-try-it-out-3">Try it Out</a></li>
        </ul>
      </li>
      <li><a href="#prompt-configuration-applications" id="markdown-toc-prompt-configuration-applications">Prompt Configuration Applications</a></li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<section class="note">
<p>
The icon characters used in some of the example format-strings require you to install a specific font and configure your terminal emulator to use it.
See <a href="https://www.nerdfonts.com/#home">Nerd Fonts</a> for details.
</p>
<p>
I like the monospace <a href="https://www.programmingfonts.org/#hack">Hack</a> font, personally.
</p>
<p>
If you do not want to install a new font, you can either omit the lines with broken fonts, or you can replace them with ASCII characters or unicode glyphs supported by your current font.
</p>
<p>
If you are on Mac, you should be able to install these fonts via `homebrew`.
</p>
</section>

<p>The default <code>zsh</code> prompt is very basic, usually just the system’s <code>hostname</code> followed by a ‘%’.</p>

<p><img src="./images/PS1-default.png" alt="image" title="Default prompt" /></p>

<p>But you can configure the prompt to show whatever information you want, like the current working directory, the date and time, the name of the current git branch, and whether you have changes that have not been committed, etc.</p>

<p>The simple, hand-made <code>zsh</code> prompt we create in this chapter:</p>

<p><img src="./images/PS1-simple.png" alt="image" /></p>

<p>An example of a prompt generated by another program (<code>p10k</code>):</p>

<p><img src="./images/PS1-p10k.png" alt="image" /></p>

<p>Things you might want in your prompt:</p>

<ul>
  <li>The current working directory</li>
  <li>Git/VCS info (branch, action, staged/unstaged changes, etc.)</li>
  <li>The current date or time</li>
  <li>The status code of the previous command (<code>$?</code>)</li>
  <li>The number of background jobs (running programs sent to the background with <code>ctrl-z</code>)</li>
</ul>

<p>You can copy the contents of the example file and add it to your own <code>.zshrc</code> file, but these options are more subjective to personal preference, so you might want to customize things a little further.</p>

<h3 id="exploring-the-example-configuration">Exploring the Example Configuration</h3>

<p>We will use <code>print -P</code> to test out some different prompt strings, configure a <code>git</code> info section, and then <code>source</code> the included <a href="./prompt-example.zsh">prompt-example.zsh</a> and test out the difference.</p>

<p>Open this document in a window on one side of your screen and open your terminal emulator on the other half.</p>

<p>Start a fresh <code>zsh</code> session:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zsh <span class="nt">-df</span>
</code></pre></div></div>

<p><img src="./images/PS1-default.png" alt="image" title="Default prompt" /></p>

<p>Take note of the default prompt, then import the example file and observe the difference:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ./prompt-example.zsh
</code></pre></div></div>

<p><img src="./images/PS1-simple.png" alt="image" /></p>

<h2 id="the-ps1-variable">The PS1 Variable</h2>

<p>The shell prompt is actually defined in an environment variable that you can set in your <code>~/.zshrc</code> file.</p>

<p>To see your current prompt-string:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nv">$PS1</span>
 %m%# 
</code></pre></div></div>

<p>The <code>%</code> characters start special sequences that will be translated to specific values when the prompt is displayed. For example, <code>%m</code> will be replaced with the hostname of the host system.</p>

<h2 id="the-basics">The Basics</h2>

<p>You can test a prompt-string with <code>print -P</code></p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print <span class="nt">-P</span> <span class="s2">"%m%# "</span>
 <span class="nb">hostname</span>% 
</code></pre></div></div>

<p>Here are the options used in the prompt from the example file:</p>

<ul>
  <li><code>%1d</code> - <code>%d</code> prints the current working directory. The <code>1</code> means only show the current directory name, and not all of it’s ancestors that make the full path.</li>
  <li><code>%?</code> - The status code from the previous command in this session.</li>
</ul>

<h3 id="try-it-out">Try it Out</h3>

<p>Run the following commands:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nv">$HOSTNAME</span>
print <span class="nt">-P</span> <span class="s2">"%m%# "</span>
</code></pre></div></div>

<p>Try adding <code>%d</code> to print the current working directory, and then try with <code>%1d</code> instead. Try other numbers instead of just <code>1</code>, maybe even try some negative numbers…</p>

<p>Try running <code>man zshmisc</code> from the prompt and then searching (with <code>/</code>) for <code>EXPANSION OF PROMPT SEQUENCES</code> to see every code that is available. Add something to your prompt-string that we haven’t covered.</p>

<h2 id="colors-and-escape-sequences">Colors and Escape Sequences</h2>

<p>The traditional way of defining styles and colors in the terminal is to use <a href="https://en.wikipedia.org/wiki/ANSI_escape_code">ANSI escape codes</a>.</p>

<p>So if you wanted to print “HELLO” in green, bold text, with underline, you’d write something like:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"</span><span class="se">\0</span><span class="s2">33[32;1;4mHELLO</span><span class="se">\0</span><span class="s2">33[0m"</span>
</code></pre></div></div>

<p>This is pretty crazy, but not as bad as it looks:</p>

<ul>
  <li><code>\033[...m</code> means anything between the <code>[</code> and the <code>m</code> should be interpreted as an escape sequence of integer values separated by ‘;’ characters.</li>
  <li><code>32</code> means foreground color green.</li>
  <li><code>1</code> means <strong>bold</strong></li>
  <li><code>4</code> means <ins>underline</ins>.</li>
  <li>Then <code>\033[0m</code>, at the end, means reset to the default style again.</li>
</ul>

<p>But <code>zsh</code> gives us some easier options for working with colors and styles:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print <span class="nt">-P</span> <span class="s1">'%B%U%F{green}Hello%f%u%b'</span>
</code></pre></div></div>

<p>OK, that doesn’t look much better, but let’s go over it:</p>

<ul>
  <li><code>%B...%b</code> - anything between <code>%B</code> and <code>%b</code> will be <strong>bold</strong>.</li>
  <li><code>%U...%u</code> - anything between <code>%U</code> and <code>%u</code> will be <ins>underlined</ins>.</li>
  <li><code>%F{green}...%f</code> - anything between <code>}</code> and <code>%f</code> will have a green foreground color.</li>
</ul>

<h3 id="try-it-out-1">Try it Out</h3>

<p>Start a <code>zsh</code> session, but don’t import the example file just yet:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zsh <span class="nt">-df</span>
</code></pre></div></div>

<p>Try running <code>man zshmisc</code> from the prompt and then searching (with <code>/</code>) for <code>"EXPANSION OF PROMPT SEQUENCES"</code> to see every code that is available - and this time scroll down and look for the sub-section on ‘Visual Effects.’</p>

<p>Try modifying this format string <code>%F{green}Hello%f</code> to have two sections of text, with opposite foreground and background colors. So maybe “HELLO” in green foreground and black background, and “WORLD” in black foreground and green background. Use <code>print -P</code> to test it out.</p>

<p><span style="background: black; color: green">HELLO</span> <span style="background: green; color: black">WORLD</span></p>

<details>

<summary>Answer</summary>

```zsh
print -P "%F{green}%K{black}Hello%k%f %F{black}%K{green}World%k%f"
```
</details>

<h2 id="vcs-git-information">VCS (Git) Information</h2>

<p>The example file includes a section that configures <code>zsh</code> to read information about the current git repository, and we use <code>zstyle</code> ton configure how it will be displayed in the prompt.</p>

<p>I won’t explain the <code>zstyle</code> module, but you can run <code>man zshmodules</code> and search for <code>zstyle</code> for the official documentation, and there are a lot of good tutorials available on the internet.</p>

<p>I will go over some of the things that I think you may want to customize, using all of the things we’ve covered so far:</p>

<ol>
  <li>The normal <code>git</code> status format.</li>
</ol>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zstyle <span class="s1">':vcs_info:git:*'</span> formats <span class="s1">'%F{green} %f(%b)%F{yellow}%u%c%f'</span>
</code></pre></div></div>

<p>This format string will show:</p>

<ul>
  <li>A green ‘git’ icon (you need a specific font to see it properly).</li>
  <li>The name of the current branch, in parentheses.</li>
  <li>In yellow, two characters that will indicate if you have pending staged or unstaged changes in your working tree. If you don’t have any pending changes, these characters will not show up.</li>
</ul>

<ol>
  <li>How to display the ‘staged’/’unstaged’ indicators:</li>
</ol>

<p>If you want to use the <code>%u</code> and <code>%c</code> characters to indicate that you have pending changes, then you may want to customize the content they show. By default, they show a <code>U</code> and a <code>C</code>, but I’ve changed them to use icons (which you probably cannot see here, without the appropriate font):</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zstyle <span class="s1">':vcs_info:git:*'</span> stagedstr <span class="s2">" "</span>
zstyle <span class="s1">':vcs_info:git:*'</span> unstagedstr <span class="s2">" "</span>
</code></pre></div></div>

<p>You may want to use different icons, or entirely different format strings of some type. You can remove these two lines if you prefer the default <code>U</code> and <code>C</code> characters, or you can delete these lines and remove the <code>%c</code> and <code>%u</code> from the <code>git</code> status format string.</p>

<ol>
  <li>“Actions” format:</li>
</ol>

<p>When you are performing an ‘action’, like resolving conflicts while trying to apply a merge or rebase, you can use this to show information about that operation in your prompt.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zstyle <span class="s1">':vcs_info:git:*'</span> actionformats <span class="s1">'%F{green} %f(%F{yellow}%b%f|%F{red}%a%f)'</span>
</code></pre></div></div>

<p>This is the same as the normal <code>git</code> prompt we defined, but it says the name of the ‘action’ (“merge”, “rebase”, etc.) inside the parentheses, where we have the branch name.</p>

<h3 id="try-it-out-2">Try it Out</h3>

<p>Start a <code>zsh</code> session and source the example file:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zsh <span class="nt">-df</span>
<span class="nb">source</span> ./prompt-example.zsh
</code></pre></div></div>

<p>Try creating a new branch with <code>git checkout -b test-branch</code> and observe the changes to the prompt.</p>

<p>Now try making a change to one of the files in this repository, which should make an ‘unstaged’ change.</p>

<p>Now run <code>git add FILENAME</code> to stage that change (replace <code>FILENAME</code> with the name of the file that you modified).</p>

<p>Now you can go back to the <code>master</code> branch with <code>git checkout master</code>.</p>

<p>If you want, delete that test branch with <code>git branch -D test-branch</code>.</p>

<h2 id="the-rprompt-variable">The RPROMPT Variable</h2>

<p>You can also define a prompt-string to display on the right-side of the command-line by setting the <code>RPROMPT</code> variable:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">RPROMPT</span><span class="o">=</span><span class="s1">'%F{blue}%t%f'</span>
</code></pre></div></div>

<p>This would show the current time, in blue text, on the far right side of your command line.</p>

<p><img src="./images/rprompt.png" alt="image" /></p>

<h2 id="conditional-formats">Conditional Formats</h2>

<p>There are a few conditional formatting options you can apply to your prompt.</p>

<p>Run <code>man zshmisc</code> from the prompt and then searching (with <code>/</code>) for <code>CONDITIONAL SUBSTRINGS IN PROMPT</code>.</p>

<p>There are only a fixed few variables/conditions, and the syntax is a little strange.</p>

<p><code>%(CONDITION,TRUE,FALSE)</code></p>

<p>The escape sequence starts with <code>%(</code>, followed by:</p>

<ul>
  <li>Optionally, an integer value, that can be compared to the variable (<code>0</code> in the example below).</li>
  <li>The one-character ‘conditional variable’ that evaluates when the prompt is rendered (like <code>?</code>).</li>
  <li>Followed by a delimiter (for example: <code>,</code>).</li>
  <li>Then the ‘true’ format string value.</li>
  <li>Then the delimiter again (<code>,</code>).</li>
  <li>Then the ‘false’ format string value.</li>
  <li>Then <code>)</code> to close the sequence.</li>
</ul>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print <span class="nt">-P</span> <span class="s1">'%0(?,0,%F{red}%?%f)'</span>
</code></pre></div></div>

<p>This will print the status code of the previous command, in red, if the code was non-zero. If the code was zero, it prints a zero in the default color.</p>

<ul>
  <li><code>%0(</code> - We’re evaluating condition that means ‘if status code == N’. This specifies N = 0 for our comparison.</li>
  <li><code>?</code> - The condition is based on the status code of the last command (equal to N). A value of zero means the previous command exited without error.</li>
  <li><code>,</code> - The delimiter we chose to use is a <code>,</code> (comma). You can use anything, as long as you don’t use that same value in your format string.</li>
  <li><code>0</code> - The ‘true’ prompt-string. Just prints a <code>0</code> in the default colors.</li>
  <li><code>,</code> The same delimiter character again.</li>
  <li><code>%F{red}%?%f</code> - The ‘false’ condition (NOT equal to 0), which prints the response code in red.</li>
</ul>

<p>Here is the final prompt format, including conditional formatting for background jobs and the status code of the previous command.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s1">'${vcs_info_msg_0_} %F{blue} %f%1d%1(j. %F{yellow}%j%f.)%F{blue}&gt;%f '</span>
<span class="nb">export </span><span class="nv">RPROMPT</span><span class="o">=</span><span class="s1">'&lt;%0(?..%F{red}%?%f)%F{blue}%t%f'</span>
</code></pre></div></div>

<p>If these are not sufficient, you can always call a function or another program to implement conditional formatting.</p>

<h3 id="try-it-out-3">Try it Out</h3>

<p>Type an invalid command, like <code>ls</code> for a directory that doesn’t exist:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls </span>xyz123
</code></pre></div></div>

<p>You should see a red status code in your prompt string.</p>

<p>Now try suspending a job to the background with <code>ctrl+z</code>:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>less ./README.md
</code></pre></div></div>

<p>Press <code>ctrl+z</code> to suspend the process to the background. You should see a yellow <code>1</code> next to your prompt now.</p>

<p>Type <code>fg</code> to bring the job back to the foreground, then hit <code>q</code> to exit.</p>

<h2 id="prompt-configuration-applications">Prompt Configuration Applications</h2>

<p>There are also programs and utilities that you can use to generate a more complicated, themed prompt. There are even programs that are designed to be run inside the prompt to dynamically change the prompt-string by using a language like Python.</p>

<p>Here are a couple that I know of:</p>

<ul>
  <li><a href="https://github.com/romkatv/powerlevel10k">powerlevel10k</a>
    <ul>
      <li>This is old and will no longer be updated. It still works though.</li>
      <li>This is a program that will generate a really complicated prompt-string with colors, and icons, and cool stuff.</li>
    </ul>
  </li>
  <li><a href="https://github.com/starship/starship">starship</a>
    <ul>
      <li>This is the suggested replacement for <code>p10k</code>.</li>
      <li>Advertised as being ‘blazing-fast, and infinitely customizable’</li>
    </ul>
  </li>
  <li><a href="https://powerline.readthedocs.io/en/master/index.html">powerline</a>
    <ul>
      <li>A python program that runs in your prompt string.</li>
      <li>One of the original fancy-prompt tools.</li>
      <li>Has support for shell prompts and <code>vim</code> status bar, to give consistent style and theme.</li>
      <li>Downside: it’s pretty slow and will often crash when your system python version changes.</li>
    </ul>
  </li>
</ul>

<p>If you want to go this way, I’d recommend <code>starship</code>.</p>

<p>The <code>git</code> prompts from <code>starship</code> and <code>p10k</code> can show a lot more information about the state of the repository than the simple <code>vcs_info</code> can, like if you’re branch is ahead of the origin, or if you have untracked files, etc. On the other hand, the operations required to get that extra info can make your prompt feel very sluggish when you are working on a large repository.</p>

<p>I would stay away from <code>powerline</code> or anything else that runs “in your prompt string.” When <code>powerline</code> crashes, it means you have no useful prompt, and sometimes you can’t even interact with your shell!</p>

<p>But you already have a lean, fast, and personally customized prompt so you don’t really need to use these.</p>

<hr />

<p><a href="./03_completion">NEXT »</a></p>

    </main>
    <footer>
      <a href="/jekyll-test/"> davelab</a>
      <section>
        <a href="/jekyll-test/test">(Secret test page)</a>
        <a href="/jekyll-test/about">ABOUT</a>
        <a href="https://github.com/dczmer/davelab.git" target="_blank"> GITHUB</a>
      </section>
    </footer>
  </body>
</html>
