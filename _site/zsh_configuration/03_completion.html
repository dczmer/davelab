<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Completion System</title>
    <link rel="stylesheet" href="http://localhost:4000//jekyll-test/css/reset.css" />
    <link rel="stylesheet" href="http://localhost:4000//jekyll-test/css/dracula-rouge.css" />
    <link rel="stylesheet" href="http://localhost:4000//jekyll-test/css/site.css" />
    <link rel="shortuct icon" type="image/ico" href="http://localhost:4000//jekyll-test/img/favicon.ico" />
  </head>
  <body>
    <header>
      <section>
        <a href="/jekyll-test/"> davelab</a>
      </section>
      <section title="I feel like there needs to be something on this side...">
        <a href="https://github.com/dczmer/davelab.git">
           GitHub
        </a>
      </section>
    </header>
    <nav>
      <section>
        
        
          
          
          
        
          
          
          
            <section class="subnav">
              <span class="selected-module">
                Zsh configuration
              </span>
              <ul class="">
                
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/zsh_configuration/index"
                    >
                      ZSH Configuration Intro
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/zsh_configuration/01_zsh-config"
                    >
                      Basic ZSH Configuration
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/zsh_configuration/02_prompt"
                    >
                      Configuring Your Prompt
                    </a>
                  </li>
                
                  <li>
                    <a
                      class="selected-section"
                      href="http://localhost:4000/jekyll-test/zsh_configuration/03_completion"
                    >
                      The Completion System
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/zsh_configuration/04_complete-setup"
                    >
                      Completed Configuration
                    </a>
                  </li>
                
              </ul>
            </section>
          
        
          
          
          
            <section class="subnav">
              <span class="">
                Using the shell
              </span>
              <ul class="subnav-inactive">
                
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/index"
                    >
                      Shell Intro
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/01_help-hisory"
                    >
                      Finding Help
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/02_expansion-signals"
                    >
                      Expansion and Signals
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/03_streams-and-pipes"
                    >
                      (WIP) Streams and Pipes
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/04_commands"
                    >
                      Useful Commands
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/using_the_shell/05_one-liners"
                    >
                      (WIP) Useful One-Liners
                    </a>
                  </li>
                
              </ul>
            </section>
          
        
          
          
          
            <section class="subnav">
              <span class="">
                Tmux
              </span>
              <ul class="subnav-inactive">
                
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/tmux/index"
                    >
                      Tmux Intro
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/tmux/01_basic-usage"
                    >
                      Tmux Basic Usage
                    </a>
                  </li>
                
                  <li>
                    <a
                      class=""
                      href="http://localhost:4000/jekyll-test/tmux/02_configuration"
                    >
                      Tmux Configuration
                    </a>
                  </li>
                
              </ul>
            </section>
          
        
      </section>
    </nav>
    <main>
      <h1 id="the-completion-system">The Completion System</h1>

<ul id="markdown-toc">
  <li><a href="#the-completion-system" id="markdown-toc-the-completion-system">The Completion System</a>    <ul>
      <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
      <li><a href="#auto-complete-engine" id="markdown-toc-auto-complete-engine">Auto-Complete Engine</a>        <ul>
          <li><a href="#try-it-out" id="markdown-toc-try-it-out">Try it Out</a></li>
        </ul>
      </li>
      <li><a href="#customizing-it" id="markdown-toc-customizing-it">Customizing it</a>        <ul>
          <li><a href="#try-it-out-1" id="markdown-toc-try-it-out-1">Try it Out</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<p><code>zsh</code> has an advanced completion engine that can be used to autocomplete the name of a command, the path to a file, or even command arguments.</p>

<p><img src="./images/completion.png" alt="image" /></p>

<p>It will help you complete the name of a command and even auto-correct spelling mistakes. It will also allow you to autocomplete command arguments by showing a menu of the valid options for the current context.</p>

<p><img src="./images/spelling.png" alt="image" /></p>

<h2 id="auto-complete-engine">Auto-Complete Engine</h2>

<p>To enable the autocomplete engine, we have to call the <code>compinit</code> shell function.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>autoload <span class="nt">-U</span> compinit <span class="o">&amp;&amp;</span> compinit
</code></pre></div></div>

<p>Once the completion engine is loaded, you don’t need to do anything else. <code>zsh</code> ships with completion support for many standard commands, and most tools you install through a package manager will install <code>zsh</code> completion support automatically.</p>

<p>There are many other projects and packages you can find that will add more completion support for other programs. You can also write your own completion rules, but you will need a different guide for that.</p>

<p>You may also want to enable <code>bashcompinit</code> the same way as you did for <code>compinit</code>. This will give <code>zsh</code> the ability to use any existing <code>bash</code> completion functions with the <code>zsh</code> completion engine.</p>

<h3 id="try-it-out">Try it Out</h3>

<p>Start a new <code>zsh</code> session, but don’t <code>source</code> the example file just yet:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zsh <span class="nt">-df</span>
</code></pre></div></div>

<p>Now type the (incomplete) command “<code>sed </code>” (note the space at the end), and press <code>tab</code>. Since the completion engine has not been initialized, you will get the default shell completion, which is usually to show a simple menu with the files in the current directory.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hostname</span>% <span class="nb">sed</span> &lt;TAB&gt;
 README.md
 zshrc-example.zsh
</code></pre></div></div>

<p>You can cycle through the options by pressing <code>tab</code> again, and then enter/return to select an option.</p>

<p>But these options don’t make any sense for the <code>sed</code> command, it doesn’t expect a filename as a positional argument.</p>

<p>Now enter the command <code>autoload compinit &amp;&amp; compinit</code> and the completion engine will show a more appropriate menu for the context:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hostname</span>% autoload compinit <span class="o">&amp;&amp;</span> compinit
<span class="nb">hostname</span>% <span class="nb">sed</span> &lt;TAB&gt;
 <span class="c">#  -- comment</span>
 :  <span class="nt">--</span> place label
 <span class="o">=</span>  <span class="nt">--</span> print current line number
 D  <span class="nt">--</span> delete up to the first newline <span class="k">in </span>the pattern space
 ...<span class="o">(</span>truncated<span class="o">)</span>
</code></pre></div></div>

<p>Now you will see a list of all the options that are actually appropriate for <code>sed</code>.</p>

<h2 id="customizing-it">Customizing it</h2>

<p>The completion engine uses many variables to configure it’s behavior and control how values are formatted for display.</p>

<p>I won’t try to explain <code>zstyle</code> or all of the possible options, but I’ll cover some that I think are important and/or useful to include in your own configuration.</p>

<p>This rule will ensure that the core completion engine is enabled, along with an extension that will try to auto-correct typos:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zstyle <span class="s1">':completion:*'</span> completer _extensions _complete _approximate
</code></pre></div></div>

<p>This will enable caching of completion data to make future completions much faster:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zstyle <span class="s1">':completion:*'</span> use-cache on
zstyle <span class="s1">':completion:*'</span> cache-path <span class="s2">"</span><span class="nv">$XDG_CACHE_HOME</span><span class="s2">/zsh/.zcompcache"</span>
</code></pre></div></div>

<p>When you hit <code>&lt;TAB&gt;</code>, this will show a menu with all the valid options and allow fuzzy searching through the results:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zstyle <span class="s1">':completion:*'</span> menu <span class="k">select </span>search
</code></pre></div></div>

<p>This will allow grouping of various completion suggestions. For example, if you have a command that expects a file OR a directory as the next parameter, the completion menu will show you the options separated into groups for ‘files’ and ‘directories.’</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zstyle <span class="s1">':completion:*'</span> group-name <span class="s1">''</span>
</code></pre></div></div>
<p>This makes the completion menu colorize entries in the same way as <code>ls --color</code>:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zstyle <span class="s1">':completion:*:default'</span> list-colors <span class="s2">"</span><span class="k">${</span><span class="p">(s.</span>:.<span class="p">)LS_COLORS</span><span class="k">}</span><span class="s2">"</span>
</code></pre></div></div>

<p>With this line, the completion engine will NOT jump to the first menu entry immediately. Instead, it will let you keep typing the command to further filter the menu, and you can press <code>&lt;tab&gt;</code> once more to jump to the first menu option.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unsetopt MENU_COMPLETE
</code></pre></div></div>

<p>If you don’t like having to hit <code>&lt;tab&gt;</code> a second time to use the menu, change this to <code>setopt MENU_COMPLETE</code> instead.</p>

<h3 id="try-it-out-1">Try it Out</h3>

<p>Start a new session with <code>zsh -df</code> and then enable <code>compinit</code>, like we did in the last exercise.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>autoload compinit <span class="o">&amp;&amp;</span> compinit
</code></pre></div></div>

<p>Try the following, and observe the autocomplete behavior and menu presentation, and we’ll see how it changes when we enable all of these options after that.</p>

<ol>
  <li>Type <code>ls</code> and press <code>&lt;TAB&gt;</code> (no trailing space because we want to complete the command name, not the arguments).</li>
  <li>Type <code>ls </code> and press <code>&lt;TAB&gt;</code> (trailing space this time, because we want to complete arguments)</li>
  <li>Type <code>fidn</code> and press <code>&lt;TAB&gt;</code> (typo of the command <code>find</code>).</li>
</ol>

<p>Number 3 won’t do anything interesting because we haven’t enabled auto-correction yet.</p>

<p>Now source the example file:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ./completion-example.zsh
</code></pre></div></div>

<p><a href="./prompt-example.zsh">Download the example file here.</a></p>

<p>Now try those three examples again, and note the differences.</p>

<hr />

<p><a href="./04_complete-setup">NEXT »</a></p>

    </main>
    <footer>
      <a href="/jekyll-test/"> davelab</a>
      <section>
        <a href="/jekyll-test/test">(Secret test page)</a>
        <a href="/jekyll-test/about">ABOUT</a>
        <a href="https://github.com/dczmer/davelab.git" target="_blank"> GITHUB</a>
      </section>
    </footer>
  </body>
</html>
